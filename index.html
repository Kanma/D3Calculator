<html>
<head>
    <title>Diablo 3 Calculator</title>
    <link rel="stylesheet" href="css/calculator.css" />
    <link rel="stylesheet" href="css/jquery-impromptu.css" />
    <script src="js/jquery.js" type="text/javascript"></script>
    <script src="js/jquery-impromptu.js" type="text/javascript"></script>
    <script src="js/diablo3.js" type="text/javascript"></script>
    <script src="js/models/hero.js" type="text/javascript"></script>
    <script src="js/models/item.js" type="text/javascript"></script>
    <script src="js/views/statistics.js" type="text/javascript"></script>
    <script src="js/views/heroes_list.js" type="text/javascript"></script>

    <script type="text/javascript">

        // Global variables
        var heroes = new Array();
        var current_hero = null;

        function onHeroesListChanged()
        {
            var previous_list = $('#heroes_list');
            if (previous_list.length == 1)
                $('#heroes_panel')[0].removeChild(previous_list[0]);

            $('#heroes_panel')[0].appendChild(Diablo3.views.heroesList(heroes, selectHero, 'heroes_list'));
        }


        function newHero()
        {
            function validate(e, v, message, form)
            {
                var error = false;

                var element = message.children('#name');
                var error_name = (form.name == "");
                if (!error_name)
                {
                    for (var i = 0; i < heroes.length; ++i)
                    {
                        if (heroes[i].name == name)
                        {
                            error_name = true;
                            return;
                        }
                    }
                }

                if (error_name)
                {
                    element.css("border", "solid #FF0000 1px");
                    error = true;
                }
                else
                {
                    element.css("border", "solid #FFFFFF 1px");
                }

                return !error;
            }


            function callback(e, v, message, form)
            {
                if (v !== undefined)
                {
                    var hero = new Diablo3.Hero();
                    hero.name = form.name;

                    heroes.push(hero);

                    onHeroesListChanged();
                }
            }


            var txt = 'Name: <input type="text" id="name" name="name" value="" /><br />';

            $.prompt(txt, {
                submit: validate,
                callback: callback,
            });

            return false;
        }


        function selectHero(name)
        {
            var element_to_remove = $('#base_statistics');
            if (element_to_remove.length == 1)
                $('#base_statistics_container')[0].removeChild(element_to_remove[0]);

            element_to_remove = $('#statistics');
            if (element_to_remove.length == 1)
                $('#statistics_container')[0].removeChild(element_to_remove[0]);

            $('#hero_details').hide();

            current_hero = null;

            for (var i = 0; i < heroes.length; ++i)
            {
                if (heroes[i].name == name)
                {
                    current_hero = heroes[i];

                    $('#base_statistics_container')[0].appendChild(Diablo3.views.baseStatistics(current_hero, 'base_statistics'));
                    $('#statistics_container')[0].appendChild(Diablo3.views.statistics(current_hero, 'statistics'));

                    $('#hero_details').show();

                    return false;
                }
            }

            return false;
        }

    </script>
</head>
<body>

    <div id="heroes_panel">
        <h1>Choose a hero</h1>
        <a href="#" onclick="newHero(); return false;">Create a new hero</a>
    </div>

    <div id="hero_details" style="display: none">
        <div id="base_statistics_container" class="inline">
            <h2>Base statistics</h2>
        </div>

        <div id="statistics_container" class="inline">
            <h2>Statistics</h2>
        </div>
    </div>

    <script type="text/javascript">
        jQuery(document).ready(function() {
            heroes = Diablo3.loadHeroesList();
            onHeroesListChanged();
        });
    </script>

</body>
</html>
